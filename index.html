<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Modified Rewordify.com School Clock shows you what period you're in, every second of the day." />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="-1" />

  <title>Schedule Monitor</title>
  <link rel="icon" href="icon/monitor.png" />
  <link rel="stylesheet" type="text/css" href="css/styles.css?v=211" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
</head>
<body id="body">
  <div class="button-panel info">
    <button id="odd-even-toggle" onclick="ToggleScheduleOddEven()" class="normal-state schedule-button button">Odd/Even Toggle</button>
    <div id="mainScheduleButtons"></div>
    <select id="special-schedule" class="schedule-button" onchange="HandleSpecialScheduleChange()">
      <option value="Nothing">Special Schedules</option>
    </select>
    <button id="auto-schedule" onclick="AutoSchedule()" class="schedule-button button">Auto</button>
  </div>

  <div id="container">
    <div id="timer_type" style="font-size: 4em">Loading...</div>
    <div id="subtitle">Please wait</div>
    <div id="currentdate"></div>
    <div id="currentperiodsubtitle"></div>
    <div id="currentschedule"></div>
    <div id="currentlengthofperiod"></div>
    <div id="endofschedulesubtitle"></div>
    <div id="currentduration"></div>
    <div id="nextperiodsubtitle"></div>
    <div id="nextschedule"></div>
    <div id="nextduration" style="font-size: 5em; margin-top: 8px; color: orange"></div>
    <div id="scheduledisplay"></div>
    <div id="tomorrowScheduleTitle" class="hidden">Tomorrow's Schedule:</div>
    <div id="tomorrowScheduleDisplay" class="hidden">Unknown</div>

    <div id="settingsModal" class="hidden draggable">
      Color Scheme: 
      <select style="margin-top: 12px" id="colorscheme" onchange="colorBackground()">
        <option value="gb" selected>Gray on black</option>
        <option value="wb">White on black</option>
        <option value="bw">Black on white</option>
        <option value="dk">Dark room</option>
        <option value="bg">Blue on green</option>
        <option value="py">Purple on yellow</option>
        <option value="sr">Random by minute</option>
      </select>
      <br />
      Time adjustment in seconds: 
      <input type="text" style="margin-top: 12px; width: 30px" id="timeadj" value="0"
             onfocus="if(this.value=='0'){this.value='';}" 
             oninput="if(this.value==''){inputTimeAdj('');} else { timeadj(); adjustInputWidth(this.value); }" 
             onblur="if(this.value==''){this.value='0'; timeadj();}" />
      <div id="resultDisplay"></div>
      <div id="secondsDisplay"></div>

      <br />
      <div id="fastForward">
        <button onclick="previousDay()" id="previousDay" class="button"><<</button>
        Day selector
        <button onclick="nextDay()" id="nextDay" class="button">>></button>
      </div>

      <br />
      <div id="frequencySelection">
        Updates per ms:
        <select name="updateTime" id="updateFrequencies" class="centered-dropdown">
          <option value="2000">2000</option>
          <option value="1000" selected>1000</option>
          <option value="250">250</option>
          <option value="200">200</option>
          <option value="100">100</option>
          <option value="50">50</option>
          <option value="16">Real Time</option>
        </select>
        <br /><br />
        <button id="closeEdit" class="button">Close</button>
      </div>
    </div>
    <button id="showTimerButton" class="bottom" onclick="showTimer()">Timer</button>
    <button id="manageSchedulesButton" class="bottom" onclick="openScheduleManager()">Schedules</button>
    <button id="calendarButton" class="bottom" onclick="openCalendar()">Calendar</button>
    <button id="toggleButton" class="bottom">Settings</button>
    <footer>
      <div class="info">
        <a href="https://github.com/oirehm/schedulemonitor/blob/main/Changelog.md" target="_blank">Changelog</a>
        <a href="https://github.com/oirehm/schedulemonitor" target="_blank">GitHub</a>
        <a id="schoolSchedule" href="#" target="_blank">Bellflower Calendar</a>
      </div>
    </footer>

    <div id="timerPanel" class="hidden timerPanel draggable resizable">
      <div id="timerDisplay">
        <span id="hourTimer" contenteditable="true">00</span>:
        <span id="minuteTimer" contenteditable="true">00</span>:
        <span id="secondTimer" contenteditable="true">00</span>
      </div>
      <br />
      <div id="hintTimer" class="hidden">Click anywhere to stop alarm</div>
      <button id="startButton" class="timerButton button" onclick="startTimer()">Start</button>
      <button id="pauseButton" class="hidden timerButton button" onclick="pauseTimer()">Pause</button>
      <button id="stopAlarmButton" class="hidden timerButton button" onclick="stopTimerAlarm()">Stop</button>
    </div>

    <div id="scheduleManagerModal" class="hidden">
      <div id="scheduleManagerContent">
        <div id="scheduleManagerHeader">
          <h2>Schedule Configuration <span id="liveIndicator" style="font-size: 0.6em; color: #666; margin-left: 10px;">(Changes apply immediately)</span></h2>
          <button class="button" onclick="closeScheduleManager()">×</button>
        </div>
        <div id="scheduleManagerBody">
          <div class="schedule-section">
            <h3>Main Schedules</h3>
            <div id="mainSchedulesList" class="schedule-list"></div>
          </div>
          <div class="schedule-section">
            <h3>Special Schedules</h3>
            <div id="specialSchedulesList" class="schedule-list"></div>
          </div>
          <div class="schedule-section">
            <h3>Custom Schedules</h3>
            <div id="customSchedulesList" class="schedule-list"></div>
            <button class="button action-button" onclick="createNewSchedule()">+ Add Custom Schedule</button>
          </div>
        </div>
        <div id="scheduleManagerFooter">
          <button class="button" onclick="exportSchedules()">Export</button>
          <button class="button" onclick="importSchedules()">Import</button>
          <button class="button" onclick="resetToDefaults()">Reset Defaults</button>
        </div>
        <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImportFile(event)">
      </div>
    </div>

    <div id="scheduleEditorModal" class="hidden">
      <div id="scheduleEditorContent">
        <div id="scheduleEditorHeader">
          <h2 id="editorTitle">Create New Schedule</h2>
          <button class="button" onclick="closeScheduleEditor()">×</button>
        </div>
        <div id="scheduleEditorBody">
          <div class="editor-section">
            <h3>Basic Information</h3>
            <div class="editor-field">
              <label for="scheduleName">Schedule Name</label>
              <input type="text" id="scheduleName" placeholder="e.g., Modified Block" maxlength="30">
            </div>
            <div class="editor-field">
              <label for="scheduleType">Schedule Type</label>
              <select id="scheduleType" onchange="handleScheduleTypeChange()">
                <option value="single">Single Schedule</option>
                <option value="oddeven">Odd/Even Schedule</option>
              </select>
            </div>
            <div class="editor-field">
              <label for="buttonLocation">Button Location</label>
              <select id="buttonLocation">
                <option value="main">Main Buttons</option>
                <option value="special">Special Schedules Dropdown</option>
              </select>
            </div>
          </div>

          <div class="editor-section">
            <h3>Start From Template (Optional)</h3>
            <div class="editor-field">
              <select id="cloneFrom" onchange="handleCloneSelection()">
                <option value="">Start from scratch</option>
                <option value="normal">Clone from Normal Schedule</option>
                <option value="late">Clone from Late Start</option>
                <option value="minimum">Clone from Minimum Day</option>
                <option value="anchor">Clone from Anchor Day</option>
                <option value="rally">Clone from Rally Day</option>
                <option value="testing">Clone from Testing Schedule</option>
              </select>
            </div>
          </div>

          <div id="scheduleTabs" class="hidden">
            <button class="tab-button active" onclick="switchTab('odd')">Odd Days</button>
            <button class="tab-button" onclick="switchTab('even')">Even Days</button>
          </div>

          <div class="editor-section">
            <h3>Periods <span id="currentTabLabel"></span></h3>
            <div id="periodsContainer"></div>
            <button class="button action-button" onclick="addPeriod()">+ Add Period</button>
          </div>
        </div>

        <div id="scheduleEditorFooter">
          <button class="button" onclick="testSchedule()">Preview</button>
          <button class="button" onclick="saveSchedule()">Save Schedule</button>
          <button class="button" onclick="closeScheduleEditor()">Cancel</button>
        </div>
      </div>
    </div>
    <!-- Calendar Configuration Modal -->
    <div id="calendarModal" class="hidden">
      <div id="calendarContent">
        <div id="calendarHeader">
          <h2>Calendar Configuration<span id="liveIndicator" style="font-size: 0.6em; color: #666; margin-left: 10px;">(Changes apply immediately)</span></h2>
          <button class="button" onclick="closeCalendar()">×</button>
        </div>
        <div id="calendarBody">
          <div id="calendarControls">
            <button class="button" onclick="openYearOverview()">Year Overview</button>
            <button class="button" onclick="previousMonth()">◀</button>
            <span id="currentMonthYear"></span>
            <button class="button" onclick="nextMonth()">▶</button>
            <button class="button" onclick="goToToday()" style="margin-left: 20px;">Today</button>
          </div>
          <div id="calendarGrid">
            <div class="calendar-weekdays"></div>
            <div class="calendar-days"></div>
          </div>
          <div id="calendarLegend">
            <span class="legend-item"><span class="legend-color day-odd"></span> Odd</span>
            <span class="legend-item"><span class="legend-color day-even"></span> Even</span>
            <span class="legend-item"><span class="legend-color day-noSchool"></span> No School</span>
            <span class="legend-item">◆ Special Schedule</span>
          </div>
        </div>
        <div id="calendarFooter">
          <button class="button" onclick="exportCalendar()">Export Calendar</button>
          <button class = "button" onclick="importCalendar()">Import Calendar</button>
          <button class="button" onclick="clearAllCalendarData()">Clear All</button>
        </div>
      </div>
    </div>
    <!-- Enhanced context menu -->
    <div id="calendarContextMenu" class="hidden">
      <div class="context-menu-header">Regular Schedules</div>
      <div class="context-menu-item" onclick="setSelectedSchedule('normal')">Normal</div>
      <div class="context-menu-item" onclick="setSelectedSchedule('late')">Late Start</div>
      <div class="context-menu-item" onclick="setSelectedSchedule('minimum')">Minimum</div>
      <div class="context-menu-separator"></div>
      <div class="context-menu-header">Special Schedules</div>
      <div id="specialSchedulesMenu"></div>
      <div class="context-menu-separator"></div>
      <div class="context-menu-header">Custom Schedules</div>
      <div id="customSchedulesMenu"></div>
      <div class="context-menu-separator"></div>
      <div class="context-menu-item" onclick="CalendarUI.promptHolidayName()">Set Holiday...</div>
      <div class="context-menu-item" onclick="setSelectedSchedule('noSchool')">No School</div>
      <div class="context-menu-separator"></div>
      <div class="context-menu-item" onclick="clearSelectedDates()">Clear</div>
    </div>
    <!-- Year Overview Modal -->
    <div id="yearOverviewModal" class="hidden">
      <div id="yearOverviewContent">
        <div id="yearOverviewHeader">
          <h2>Year Overview - <span id="yearOverviewTitle"></span></h2>
          <button class="button" onclick="closeYearOverview()">×</button>
        </div>
        <div id="yearOverviewBody">
          <div id="yearOverviewControls">
            <button class="button" onclick="previousYear()">◀</button>
            <span id="overviewYearDisplay"></span>
            <button class="button" onclick="nextYear()">▶</button>
          </div>
          <div id="yearOverviewGrid"></div>
          <div id="yearOverviewLegend">
            <span class="legend-item"><span class="legend-color day-odd"></span> Odd Day</span>
            <span class="legend-item"><span class="legend-color day-even"></span> Even Day</span>
            <span class="legend-item"><span class="legend-color day-scheduled"></span> Scheduled (No Odd/Even)</span>
            <span class="legend-item"><span class="legend-color day-noSchool"></span> No School</span>
          </div>
        </div>
      </div>
    </div>
    <script src="script.js?v=211"></script>
  </div>
</body>
</html>