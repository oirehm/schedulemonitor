<!--
TODO
Use custom alerts rather than native alerts to match UI and to make modular
Drag and drop to reorder schedules
Fix timer and sync it with displayed clock countdown: drag issue, backward input issue
Change main UI a little more, the current time should be a little more visible, maybe overhaul UI layout. same info but arranged differently?
Fix math input when field is empty, default to 0
Have the time actually display 00 instead of stop on 01
Enhance button panel? maybe have it where it disappears after some time and you can hover up to it.
change UI: change schedules (schedule buttons + manage), actual settings cog wheel (replaces Edit button), Extra tools? (Timer)
Overhaul settings UI
Add more settings
- For current date, add date formatting type and customization on that, via buttons or direct configuration input
- For count down, add display to show in various ways: MM:ss, HH:mm:ss
Add localstorage limit visual in settings, based on stored json size
When previewing schedule, it should exit the menu temporarily but return to the exact menu
Reduce dom updates in showclock to not rebuild everything when only a few parts change


i wonder if real time update default will hurt performance

-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Modified Rewordify.com School Clock shows you what period you're in, every second of the day." />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="-1" />
  
  <title>Schedule Monitor</title>
  <link rel="icon" href="icon/monitor.png" />
  <link rel="stylesheet" type="text/css" href="css/styles.css?v=201" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
</head>
<body id="body">
  <div class="button-panel info">
    <button id="odd-even-toggle" onclick="ToggleScheduleOddEven()" class="normal-state schedule-button button">Odd/Even Toggle</button>
    <div id="mainScheduleButtons"></div>
    <select id="special-schedule" class="schedule-button" onchange="HandleSpecialScheduleChange()">
      <option value="Nothing">Special Schedules</option>
    </select>
    <button id="auto-schedule" onclick="AutoSchedule()" class="schedule-button button">Auto</button>
    <button id="showTimerButton" class="bottom" onclick="showTimer()">Timer</button>
    <button id="manageSchedulesButton" class="bottom" onclick="openScheduleManager()">Manage</button>
  </div>

  <div id="container">
    <div id="timer_type" style="font-size: 4em">Loading...</div>
    <div id="subtitle">Please wait</div>
    <div id="currentdate"></div>
    <div id="currentperiodsubtitle"></div>
    <div id="currentschedule"></div>
    <div id="currentlengthofperiod"></div>
    <div id="endofschedulesubtitle"></div>
    <div id="currentduration"></div>
    <div id="nextperiodsubtitle"></div>
    <div id="nextschedule"></div>
    <div id="nextduration" style="font-size: 5em; margin-top: 8px; color: orange"></div>

    <div id="scheduledisplay"></div>

    <div id="tomorrowScheduleTitle" class="hidden">Tomorrow's Schedule:</div>
    <div id="tomorrowScheduleDisplay" class="hidden">Unknown</div>

    <button id="toggleButton" class="button editButton info">Edit</button>

    <div id="modifyContainer" class="hidden draggable">
      Color Scheme: 
      <select style="margin-top: 12px" id="colorscheme" onchange="colorBackground()">
        <option value="gb" selected>Gray on black</option>
        <option value="wb">White on black</option>
        <option value="bw">Black on white</option>
        <option value="dk">Dark room</option>
        <option value="bg">Blue on green</option>
        <option value="py">Purple on yellow</option>
        <option value="sr">Random by minute</option>
      </select>
      <br />
      Time adjustment in seconds: 
      <input type="text" style="margin-top: 12px; width: 30px" id="timeadj" value="0"
             onfocus="if(this.value=='0'){this.value='';}" 
             oninput="if(this.value==''){inputTimeAdj('');} else { timeadj(); adjustInputWidth(this.value); }" 
             onblur="if(this.value==''){this.value='0'; timeadj();}" />
      <div id="resultDisplay"></div>
      <div id="secondsDisplay"></div>

      <br />
      <div id="fastForward">
        <button onclick="previousDay()" id="previousDay" class="button"><<</button>
        Day selector
        <button onclick="nextDay()" id="nextDay" class="button">>></button>
      </div>

      <br />
      <div id="frequencySelection">
        Updates per ms:
        <select name="updateTime" id="updateFrequencies" class="centered-dropdown">
          <option value="2000">2000</option>
          <option value="1000" selected>1000</option>
          <option value="250">250</option>
          <option value="200">200</option>
          <option value="100">100</option>
          <option value="50">50</option>
          <option value="2">Real Time</option>
        </select>
        <br /><br />
        <button id="closeEdit" class="button">Close</button>
      </div>
    </div>

    <footer>
      <div class="info">
        <a href="https://github.com/oirehm/schedulemonitor/blob/main/Changelog.md" target="_blank">Changelog</a>
        <a href="https://github.com/oirehm/schedulemonitor" target="_blank">GitHub</a>
        <a id="schoolSchedule" href="#" target="_blank">Bellflower Calendar</a>
      </div>
    </footer>

    <div id="timerPanel" class="hidden timerPanel draggable resizable">
      <div id="timerDisplay">
        <span id="hourTimer" contenteditable="true">00</span>:
        <span id="minuteTimer" contenteditable="true">00</span>:
        <span id="secondTimer" contenteditable="true">00</span>
      </div>
      <br />
      <div id="hintTimer" class="hidden">Click anywhere to stop alarm</div>
      <button id="startButton" class="timerButton button" onclick="startTimer()">Start</button>
      <button id="pauseButton" class="hidden timerButton button" onclick="pauseTimer()">Pause</button>
      <button id="stopAlarmButton" class="hidden timerButton button" onclick="stopTimerAlarm()">Stop</button>
    </div>

    <div id="scheduleManagerModal" class="hidden">
      <div id="scheduleManagerContent">
        <div id="scheduleManagerHeader">
          <h2>Manage Schedules <span id="liveIndicator" style="font-size: 0.6em; color: #666; margin-left: 10px;">(Changes apply immediately)</span></h2>
          <button class="button" onclick="closeScheduleManager()">×</button>
        </div>
        <div id="scheduleManagerBody">
          <div class="schedule-section">
            <h3>Main Schedules</h3>
            <div id="mainSchedulesList" class="schedule-list"></div>
          </div>
          <div class="schedule-section">
            <h3>Special Schedules</h3>
            <div id="specialSchedulesList" class="schedule-list"></div>
          </div>
          <div class="schedule-section">
            <h3>Custom Schedules</h3>
            <div id="customSchedulesList" class="schedule-list"></div>
            <button class="button action-button" onclick="createNewSchedule()">+ Add Custom Schedule</button>
          </div>
        </div>
        <div id="scheduleManagerFooter">
          <button class="button" onclick="exportSchedules()">Export</button>
          <button class="button" onclick="importSchedules()">Import</button>
          <button class="button" onclick="resetToDefaults()">Reset Defaults</button>
        </div>
        <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImportFile(event)">
      </div>
    </div>

    <div id="scheduleEditorModal" class="hidden">
      <div id="scheduleEditorContent">
        <div id="scheduleEditorHeader">
          <h2 id="editorTitle">Create New Schedule</h2>
          <button class="button" onclick="closeScheduleEditor()">×</button>
        </div>
        <div id="scheduleEditorBody">
          <div class="editor-section">
            <h3>Basic Information</h3>
            <div class="editor-field">
              <label for="scheduleName">Schedule Name</label>
              <input type="text" id="scheduleName" placeholder="e.g., Modified Block" maxlength="30">
            </div>
            <div class="editor-field">
              <label for="scheduleType">Schedule Type</label>
              <select id="scheduleType" onchange="handleScheduleTypeChange()">
                <option value="single">Single Schedule</option>
                <option value="oddeven">Odd/Even Schedule</option>
              </select>
            </div>
            <div class="editor-field">
              <label for="buttonLocation">Button Location</label>
              <select id="buttonLocation">
                <option value="main">Main Buttons</option>
                <option value="special">Special Schedules Dropdown</option>
              </select>
            </div>
          </div>

          <div class="editor-section">
            <h3>Start From Template (Optional)</h3>
            <div class="editor-field">
              <select id="cloneFrom" onchange="handleCloneSelection()">
                <option value="">Start from scratch</option>
                <option value="normal">Clone from Normal Schedule</option>
                <option value="late">Clone from Late Start</option>
                <option value="minimum">Clone from Minimum Day</option>
                <option value="anchor">Clone from Anchor Day</option>
                <option value="rally">Clone from Rally Day</option>
                <option value="testing">Clone from Testing Schedule</option>
              </select>
            </div>
          </div>

          <div id="scheduleTabs" class="hidden">
            <button class="tab-button active" onclick="switchTab('odd')">Odd Days</button>
            <button class="tab-button" onclick="switchTab('even')">Even Days</button>
          </div>

          <div class="editor-section">
            <h3>Periods <span id="currentTabLabel"></span></h3>
            <div id="periodsContainer"></div>
            <button class="button action-button" onclick="addPeriod()">+ Add Period</button>
          </div>
        </div>

        <div id="scheduleEditorFooter">
          <button class="button" onclick="testSchedule()">Preview</button>
          <button class="button" onclick="saveSchedule()">Save Schedule</button>
          <button class="button" onclick="closeScheduleEditor()">Cancel</button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </div>
</body>
</html>